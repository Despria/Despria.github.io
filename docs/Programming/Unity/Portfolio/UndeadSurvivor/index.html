<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Despria의 블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Despria의 블로그 Atom Feed"><title data-react-helmet="true">언데드 서바이버 | Despria의 블로그</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://Despria.github.io/docs/Programming/Unity/Portfolio/UndeadSurvivor"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="언데드 서바이버 | Despria의 블로그"><meta data-react-helmet="true" name="description" content="Undead Survivor"><meta data-react-helmet="true" property="og:description" content="Undead Survivor"><link data-react-helmet="true" rel="shortcut icon" href="/img/VeronicaSD.ico"><link data-react-helmet="true" rel="canonical" href="https://Despria.github.io/docs/Programming/Unity/Portfolio/UndeadSurvivor"><link data-react-helmet="true" rel="alternate" href="https://Despria.github.io/docs/Programming/Unity/Portfolio/UndeadSurvivor" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://Despria.github.io/docs/Programming/Unity/Portfolio/UndeadSurvivor" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3f82f11a.css">
<link rel="preload" href="/assets/js/runtime~main.084d969c.js" as="script">
<link rel="preload" href="/assets/js/main.9d55d610.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/VeronicaSD.webp" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/VeronicaSD.webp" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Despria의 블로그</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documents</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Programming</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/programming_intro">프로그래밍 관련 문서</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Unity</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Portfolio</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Programming/Unity/Portfolio/UndeadSurvivor">언데드 서바이버</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_1">Unity를 위한 기본 문법 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_2">Unity를 위한 기본 문법 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_3">Unity를 위한 기본 문법 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_4">Unity를 위한 기본 문법 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/ObjectPooling_1">Object Pooling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_1">AssetBundle 빌드하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_2">AssetBundle로부터 오브젝트 불러오기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_3">AssetBundle 사용 시 주의사항</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Programmers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Games</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Documents</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>언데드 서바이버</h1></header><p><img alt="Undead Survivor" src="/assets/images/UndeadSurvivor1-65bf11f57434268fc85b00ff8c9a58b2.jpg"></p><p>처음으로 완성한 유니티 프로젝트인 &#x27;언데드 서바이버&#x27;에 대한 정리를 해둔 글이다.<br>
첫 프로젝트를 진행하면서 되새겨둘 내용이나 여러 느낀 점을 정리해보고자 한다.<br>
제작 기간은 2022년 11월 23일부터 2022년 12월 23일이다.<br></p><p>흔히들 &#x27;뱀서류&#x27;라 부르는 뱀파이어 서바이버, 매직 서바이버를 원류로 하는 서바이벌 스타일의 게임이다.<br>
사용 에셋은 유니티 에반젤리스트이자 유튜버로 활동중이신 &#x27;골드메탈&#x27;님이 무료로 배포하는 에셋을 주로 사용했다.<br>
그 밖에 유니티 에셋스토어의 무료 배경음 에셋, 그리고 &#x27;마왕혼&#x27;이라는 일본 웹사이트의 무료 효과음을 사용하기도 했다.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="게임-기본-구성">게임 기본 구성<a aria-hidden="true" class="hash-link" href="#게임-기본-구성" title="Direct link to heading">​</a></h2><p>프리팹 생성이나 기본적인 2D 애니메이션과 같은 내용은 생략하려고 한다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="loading-scene">Loading Scene<a aria-hidden="true" class="hash-link" href="#loading-scene" title="Direct link to heading">​</a></h3><p>&#x27;언데드 서바이버&#x27;는 기본적으로 타이틀, 로딩, 게임의 3개의 Scene으로 구성되어 있다.<br>
타이틀에서는 게임에 대한 기본 설명과, 사운드 조절이 가능한 설정창을 이용할 수 있으며,<br>
UI가 아닌 다른 부분을 탭할 경우 자동으로 로딩 Scene을 거쳐 게임화면으로 넘어가게 된다.</p><p>유니티에서 다른 Scene을 로딩하면 기존 Scene에서 더 이상 사용하지 않는 모든 메모리를 정리하게 되는데,<br>
이 때, 예를 들어서 Scene A와 B가 있다고 가정하면, 아래와 같은 방식으로 메모리 정리가 이루어진다.<br>
<code>Scene A 사용 중 -&gt; Scene B 로딩 -&gt; Scene B에서 필요한 모든 오브젝트 준비 -&gt; Scene B로 전환 후 Scene A의 메모리 정리</code>
그러나, 만약 Scene A와 B에서 사용하는 메모리의 양이 너무 크다면, <br>
특히 모바일 환경에서는 메모리 사용량을 초과하여 앱 사용에 매우 좋지 못한 영향을 끼칠 우려가 있다.</p><p>그렇기 때문에, 로딩을 위한 Scene을 별도로 사용하여 일종의 완충 구간을 만드는 것이다.<br>
로딩 중 유저에게 보여줄 간단한 내용만을 담은 Scene으로 우선 전환하고, 그 다음 원래 불러오려던 Scene을 불러오게 되면<br>
이미 다량의 메모리를 사용하는 도중에 다시 큰 메모리를 사용하지 않게 되므로 안정적으로 Scene을 전환할 수 있다.<br>
물론 이 게임은 애초에 용량이 작기 때문에, 로딩용 Scene이 존재하지 않아도 별 무리는 없지만<br>
그럼에도 일종의 예행연습 개념으로 Load Scene을 구현해보았다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.SceneManagement;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// LoadScene에서 Scene 로딩을 담당하는 LoadSceneManager 스크립트.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class LoadSceneManager : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] LoadingBar loadingBar;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TipText tipText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AsyncOperation operation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int nextScene;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Unity Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tipText.SetTipText();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StartCoroutine(LoadSceneAsync());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Scene을 전환하는 처리를 담당.&lt;br/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 로딩용 Scene을 호출하고, 다시 매개변수에 해당하는 Scene으로 이동함.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;sceneState&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void LoadScene(SceneState sceneState)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nextScene = (int)sceneState;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Build Setting의 LoadScene의 인덱스가 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SceneManager.LoadScene((int)SceneState.Load);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IEnumerator LoadSceneAsync()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operation = SceneManager.LoadSceneAsync(nextScene);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// allowSceneActivation을 false로 하여 Scene 로딩을 90퍼센트 수준에서 멈추도록 함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// allowSceneActivation이 true로 변경될 시에만 나머지 로딩을 끝마치게 됨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operation.allowSceneActivation = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float timer = 0.0f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (!operation.isDone)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            yield return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            /// 로딩 진행 상황이 90퍼센트에 도달할 때까지는 로딩을 그대로 진행</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (operation.progress &lt; 0.9f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                loadingBar.Slider.value = operation.progress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            /// 로딩 진행 상황이 90퍼센트에 도달했을 경우,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            /// 일부러 짧은 페이크 로딩 시간을 발생시켜 대기하게 함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                timer += Time.unscaledDeltaTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                loadingBar.Slider.value = Mathf.Lerp(0.9f, 1f, timer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                /// 페이크 로딩 시간도 지나 로딩바가 전부 찼을 경우,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                /// allowSceneActivation을 true로 전환하여 Scene을 완전히 전환시키고 코루틴 종료</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (loadingBar.Slider.value &gt;= 1f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    operation.allowSceneActivation = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    yield break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>위의 코드는 &#x27;베르의 프로그래밍 노트&#x27; 블로그를 참고한 내용이다.<br>
<a href="https://wergia.tistory.com/183" target="_blank" rel="noopener noreferrer">베르의 프로그래밍 노트 - LoadScene Manager</a> </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="오브젝트-풀링-object-pooling">오브젝트 풀링 (Object Pooling)<a aria-hidden="true" class="hash-link" href="#오브젝트-풀링-object-pooling" title="Direct link to heading">​</a></h3><p>뱀서류 게임은 기본적으로 한 명의 플레이어가 다수의 몬스터를 상대하는 게임이기 때문에,<br>
다수의 게임 오브젝트를 효율적으로 불러오는 것이 무엇보다도 중요했다.<br>
이럴 때 사용하는 가장 좋은 기법은 오브젝트 풀링이기 때문에, 당연히 사용했다.</p><p>이전에 정리해둔 오브젝트 풀링 기법을 사용했으며, <br>
이 오브젝트 풀러는 싱글턴이기 때문에 게임 Scene에서는 필요에 따라 마음껏 오브젝트를 불러서 사용할 수 있는 구조이다.<br>
<a href="/docs/Programming/Unity/ObjectPooling_1">Object Pooling 정리글</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// 여러 게임 오브젝트를 각각의 Pool을 생성하여 관리하는 Object Pooler 클래스.&lt;br/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Queue를 이용해 만들어진 Pool들을 Dictionary를 통해 관리함.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ObjectPooler : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 각각의 Object Pool을 생성할 때 사용할 Pool 클래스</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 프리팹, 태그, Pool의 크기에 대한 정보를 저장</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [System.Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private class Pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public GameObject objectPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string tag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public int size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Pool 클래스를 모아서 ObjectPooler의 초기화에 사용할 List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 에디터에서 List의 크기를 지정하고 각 Pool 클래스의 값을 초기화함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] List&lt;Pool&gt; pools;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Pool 전체를 관리하는 poolDictionary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Dictionary&lt;string, Queue&lt;GameObject&gt;&gt; poolDictionary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 오브젝트 풀의 용량이 부족할 경우 추가적으로 오브젝트를 생성할 때</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 태그를 통해 Pool 클래스에서 오브젝트의 정보를 얻어오기 위한 poolIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Dictionary&lt;string, Pool&gt; poolIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 오브젝트를 꺼내지는 않되, 오브젝트의 정보를 확인할 CheckFromPool 메서드.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 태그를 이용해 해당되는 오브젝트를 반환함.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;tag&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameObject CheckFromPool (string tag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!poolIndex.ContainsKey(tag))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GameObject objectToCheck = poolIndex[tag].objectPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return objectToCheck;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Dictionary로부터 오브젝트를 얻어올 SpawnFromPool 메서드.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 태그를 이용해 꺼내올 오브젝트에 해당하는 pool을 찾고, 해당 오브젝트의 OnObjectSpawn 메서드를 실행함.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;tag&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;position&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;rotation&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameObject SpawnFromPool (string tag, Vector3 position, Quaternion rotation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!poolDictionary.ContainsKey(tag))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (poolDictionary[tag].Count &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GameObject objectToSpawn = poolDictionary[tag].Dequeue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            objectToSpawn.SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            objectToSpawn.transform.position = position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            objectToSpawn.transform.rotation = rotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            IPooledObject pooledObj = objectToSpawn.GetComponent&lt;IPooledObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (pooledObj != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pooledObj.OnObjectSpawn();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return objectToSpawn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GameObject newObject = Instantiate(poolIndex[tag].objectPrefab);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newObject.SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newObject.transform.position = position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newObject.transform.rotation = rotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            IPooledObject pooledObj = newObject.GetComponent&lt;IPooledObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (pooledObj != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pooledObj.OnObjectSpawn();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return newObject;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 사용한 오브젝트를 다시 Dictionary로 집어넣을 InsertToPool 메서드.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 태그를 이용해 돌아갈 pool을 찾고, 해당 pool에 오브젝트를 비활성화시켜 집어넣음.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;tag&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void InsertToPool(string tag, GameObject obj)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IPooledObject objectToInsert = obj.GetComponent&lt;IPooledObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectToInsert.OnObjectInsert();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        obj.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolDictionary[tag].Enqueue(obj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Singleton</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ObjectPooler Instance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Awake()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Instance != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Destroy(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Instance = this;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Unity Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolDictionary = new Dictionary&lt;string, Queue&lt;GameObject&gt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolIndex = new Dictionary&lt;string, Pool&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// pools List에 담긴 각 오브젝트들을 오브젝트 풀을 생성하여 집어넣음</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// 그리고 해당 오브젝트 풀을 다시 poolDictionary에 집어넣음</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (Pool pool in pools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Queue&lt;GameObject&gt; objectPool = new Queue&lt;GameObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; pool.size; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                GameObject obj = Instantiate(pool.objectPrefab);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                obj.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                objectPool.Enqueue(obj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            poolDictionary.Add(pool.tag, objectPool);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            poolIndex.Add(pool.tag, pool);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>코드상에서는 위와 같으며, 이를 빈 게임 오브젝트에 컴포넌트로 부착하고서 아래와 같이 사용할 수 있다.<br>
Pool 클래스의 멤버대로 풀에 등록할 오브젝트의 태그를 임의로 설정하고, <br>
초기에 미리 생성해 둘 개수와 프리팹을 등록한다.<br>
만약 런타임 도중 설정해 둔 개수 이상으로 오브젝트가 필요해지면, 그 때는 추가적으로 Instantiate를 하게 된다.</p><p><img alt="Object Pooling" src="/assets/images/UndeadSurvivor4-93e853b2eb8ca52baacf05e436518233.jpg"></p><p>위와 같이 설정된 오브젝트 풀러를 동일한 Scene에서 필요한 경우에 사용하면 된다.<br>
예를 들어서, 이 게임에서는 Object Spawner 오브젝트를 제작하여 아이템이나 몬스터 같이<br>
다수가 존재하면서 일정 시간마다 계속해서 생성되어야 하는 오브젝트들을 생성하도록 했다.<br>
Object Spawner의 코드 중 Object Pooler를 호출하는 부분은 아래와 같다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ObjectSpawner : GameEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SpawnMonster()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float spawnPositionX = Random.Range(mapBorderUpLeft.runtimeValue.x, mapBorderDownRight.runtimeValue.x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float spawnPositionY = Random.Range(mapBorderDownRight.runtimeValue.y, mapBorderUpLeft.runtimeValue.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Vector3 spawnPosition = new Vector3(spawnPositionX, spawnPositionY, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string monsterTag = monsterTags[Random.Range(0, monsterTags.Length)].runtimeValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ObjectPooler.Instance.SpawnFromPool(monsterTag, spawnPosition, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentMonsterNumber.runtimeValue++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SpawnItem()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float spawnPositionX = Random.Range(mapBorderUpLeft.runtimeValue.x, mapBorderDownRight.runtimeValue.x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float spawnPositionY = Random.Range(mapBorderDownRight.runtimeValue.y, mapBorderUpLeft.runtimeValue.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Vector3 spawnPosition = new Vector3(spawnPositionX, spawnPositionY, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string itemTag = itemTags[Random.Range(0, itemTags.Length)].runtimeValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // itemTags[0] == HealthPack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (itemTag == itemTags[0].runtimeValue &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maximumHealthPackNumber.runtimeValue &gt; currentHealthPackNumber.runtimeValue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectPooler.Instance.SpawnFromPool(itemTag, spawnPosition, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // itemTags[1] == Magnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (itemTag == itemTags[1].runtimeValue &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maximumMagnetNumber.runtimeValue &gt; currentMagnetNumber.runtimeValue) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectPooler.Instance.SpawnFromPool(itemTag, spawnPosition, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // itemTags[2] == RootBox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (itemTag == itemTags[2].runtimeValue &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maximumRootBoxNumber.runtimeValue &gt; currentMagnetNumber.runtimeValue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectPooler.Instance.SpawnFromPool(itemTag, spawnPosition, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="스크립터블-오브젝트-scriptable-object-적극-활용">스크립터블 오브젝트 (Scriptable Object) 적극 활용<a aria-hidden="true" class="hash-link" href="#스크립터블-오브젝트-scriptable-object-적극-활용" title="Direct link to heading">​</a></h3><p>스크립터블 오브젝트는 유니티에서 제공하는 일종의 커스텀 데이터 컨테이너라고 한다.<br>
스크립터블 오브젝트는 컴포넌트로 부착될 수 있는 MonoBehaviour를 상속받는 일반적인 스크립트들과는 다르게,<br>
ScriptableObject를 상속받으며, Scene상에서 존재할 수 없고 대신 프로젝트 상에서 Asset의 형태로 존재한다.</p><p>일반적으로는 단순히 다수의 오브젝트가 공통으로 사용하며 런타임 도중 변할 일이 없는 값을 저장하는 데에 유용하다.<br>
스크립터블 오브젝트의 값은 에디터 모드냐, 플레이 모드냐에 관계 없이 변경된 값이 계속 저장되기 때문에<br>
유동적인 값을 담는 데에는 주의가 필요하기 때문이다. (물론 아래 설명과 같이 상황에 따라 충분히 가능하긴 하다.)<br>
예를 들자면, 몬스터의 최대 체력과 같은 것은 동일한 종류의 몬스터가 모두 공유할 가능성이 높으니<br>
개별 몬스터가 최대 체력 변수를 선언하는 것 보다는 하나의 스크립터블 오브젝트에서 설정할 경우 <br>
메모리 사용량이 많이 줄어든다.</p><p>단순히 이렇게만 사용해도 유용하지만, 스크립터블 오브젝트를 보다 더 적극적으로 활용하기도 한다.<br>
<a href="https://unity.com/kr/how-to/architect-game-code-scriptable-objects" target="_blank" rel="noopener noreferrer">스크립터블 오브젝트로 게임을 설계하는 3가지 방법</a></p><p>위 링크는 유니티 공식 블로그에서 제공하는 스크립터블 오브젝트의 활용 가이드이다.<br>
스크립터블 오브젝트는 에셋의 형태로 존재하고, Scene에 관계없이 프로젝트 상에서 존재한다.<br>
그러한 점을 이용하여, 스크립터블 오브젝트를 보다 더 적극적으로 활용하는 방법에 대해서 소개하고 있고,<br>
이 점이 무척 흥미롭게 느껴져서 이번 프로젝트에 이 방법을 적용해보기로 했었다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CreateAssetMenu(fileName = &quot;Vector3&quot;, menuName = &quot;Scriptable Objects/Variables/Vector3&quot;, order = 9)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Vector3Variable : ScriptableObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3 initialValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [NonSerialized] public Vector3 runtimeValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnAfterDeserialize()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtimeValue = initialValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnBeforeSerialize() { }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void ResetValue()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtimeValue = initialValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>우선 처음으로 설명된 &#x27;변수 설계&#x27; 부분이다.<br>
글에서 설명하는 것과 마찬가지로, 예를 들어서 Vector3형 변수가 필요하다고 가정할 경우,<br>
해당 스크립터블 오브젝트 에셋을 생성하여 대신 사용할 수 있다.</p><p>이렇게 생성된 에셋을 이용하여 스크립트 상에서의 다른 오브젝트 참조를 줄이고, <br>
대신 에셋에 대한 참조로 변환할 수 있었다.<br>
예를 들어, 이 게임에서는 몬스터가 플레이어를 계속해서 쫓아다니게 하기 위해서 플레이어의 위치를 알 필요가 있는데,<br>
이 때 몬스터가 플레이어의 위치값을 담은 스크립터블 오브젝트를 멤버로 가지면<br>
런타임 도중에도 스크립터블 오브젝트의 값은 실시간으로 반영되므로 플레이어를 직접 참조할 필요가 없어진다.<br></p><p>아래 코드는 playerPosition이라는 Vector3 값을 담은 스크립터블 오브젝트를 몬스터 스크립트에서 활용하는 예시이다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.Jobs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Unity.Jobs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Unity.Burst;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Monster : MonoBehaviour, IPooledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Monster Setting&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3Variable playerPosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PositionUpdateJob positionUpdateJob;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JobHandle positionUpdateJobHandle;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransformAccessArray transformAccessArray;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BurstCompile]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct PositionUpdateJob : IJobParallelForTransform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Vector3 direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public float speed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public bool isDead;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public float jobDeltaTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void Execute(int index, TransformAccess transform)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!isDead)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                transform.position += jobDeltaTime * speed * direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnEnable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transformAccessArray = new TransformAccessArray(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transformAccessArray.Add(transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void FixedUpdate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        direction = (playerPosition.runtimeValue - transform.position).normalized;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (direction.x &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spriteRenderer.flipX = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spriteRenderer.flipX = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionUpdateJob = new PositionUpdateJob()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            direction = direction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            speed = speed.runtimeValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isDead = isDead,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            jobDeltaTime = Time.fixedDeltaTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        positionUpdateJobHandle = positionUpdateJob.Schedule(transformAccessArray);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CreateAssetMenu(fileName = &quot;Event&quot;, menuName = &quot;Scriptable Objects/Event&quot;, order = 0)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GameEvent : ScriptableObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;GameEventListener&gt; listeners = new List&lt;GameEventListener&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Raise()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; listeners.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            listeners[i].OnEventRaised();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void RegisterListener(GameEventListener listener)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listeners.Add(listener);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void UnregisterListener(GameEventListener listener)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listeners.Remove(listener); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>그 다음은 스크립터블 오브젝트를 활용한 이벤트 시스템이다.<br>
위와 같이, 스크립터블 오브젝트를 상속받는 이벤트 에셋을 만들고, 이벤트 발생을 선언할 오브젝트에 멤버로 선언한다.<br>
이벤트 발생의 조건이 충족되면, 해당 오브젝트에서 이벤트 발생을 선언한다.</p><p>이에 반응할 다른 오브젝트들의 스크립트는 아래의 GameEventListener를 상속하도록 한다.<br>
해당 GameEventListener의 Event에는 구독할 GameEvent를 등록해주면 된다. (이벤트 선언자와 동일한 스크립터블 오브젝트)<br>
그리고 반응할 때의 동작을 함수로 선언하고 Response.AddListener로 해당 함수를 등록해주면 된다.<br>
UnityEvent는 유니티에서 제공하는 이벤트 시스템인데, 이를 활용하는 것이다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.Events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// GameEvent에 반응할 오브젝트의 스크립트가 상속하는 GameEventListener.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GameEventListener : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Tooltip(&quot;Event To Subscribe&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameEvent Event;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Tooltip(&quot;UnityEvent Subscribe to GameEvent&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public UnityEvent Response;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void OnEnable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Event.RegisterListener(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void OnDisable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Event.UnregisterListener(this); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnEventRaised()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Response.Invoke();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>아래는 이 이벤트 시스템을 활용한 예시이다.<br>
플레이어가 경험치를 획득하여 레벨업을 하면, 효과음이 발생하도록 해두었다.<br>
GameEvent OnPlayerLevelUp이 바로 스크립터블 오브젝트로 설계된 이벤트이다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.InputSystem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Player : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Player Event&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] GameEvent OnPlayerLevelUp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Unity Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTriggerStay2D(Collider2D collision)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (collision.gameObject.CompareTag(&quot;Item&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GetItem(collision.gameObject.gameObject.GetComponent&lt;ICollectable&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void GetItem(ICollectable item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        item.Get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (playerExp.runtimeValue &gt;= playerMaximumExp.runtimeValue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PlayerLevelUp();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void PlayerLevelUp()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OnPlayerLevelUp.Raise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GameSceneUI.Instance.OpenSkillSelect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        playerHp.runtimeValue = playerMaximumHp.runtimeValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        playerExp.runtimeValue = 0f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Player에서 위와 같이 OnPlayerLevelUp.Raise()로 이벤트 발생을 선언하면,<br>
아래와 같은 스크립트를 부착한 오브젝트에서 반응을 하게 된다.<br>
물론 Event에 똑같이 OnPlayerLevelUp을 등록해 두어야 한다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AudioEventListener : GameEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] AudioClip audioClip;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Response.AddListener(PlayOneShot);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void PlayOneShot()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SoundManager.Instance.PlayOneShot(audioClip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>이 시스템을 활용하면서 느낀 점은 다음과 같다.<br>
사실 스크립터블 오브젝트를 위와 같이 활용하지 않고서도 충분히 기능을 구현하는 데에는 문제가 없으나,<br>
이를 활용하면 개발직군이 아닌 사람들도 에디터에서 게임 편집을 조금 더 쉽게 할 수 있지 않을까 하는 생각이 들었다.<br>
왜냐하면, 코드상에서 새로 작성하거나 수정할 필요성이 많이 없어지고, <br>
쉽게 스크립터블 오브젝트를 생성하고 에디터상에서 편집 및 테스트가 가능해지기 때문이다.</p><p>또 다른 장점이라면 역시 다른 오브젝트에 대한 참조가 많이 사라지고, 필요한 부분만 별도로 참조하게 되는 느낌이라<br>
다른 오브젝트에 대한 의존성이 많이 줄어든다는 부분이 좋아보였다.</p><p>다만, 단점이라고 느껴지는 부분이라면, 스크립터블 오브젝트로 에셋 생성 시 이름 설정에 주의해야 되지 않을까 싶었다.<br>
왜냐하면, 예를 들어 위와 같이 Vector3형 에셋인 PlayerPosition을 만들었을 경우, <br>
Player에서 PlayerPosition의 런타임 값을 변경하고, 이를 다른 오브젝트들이 멤버로 선언하여 참조하는 방식인데,<br>
에셋 작명을 직관적으로 하지 않을 경우, 에디터 상에서는 해당 에셋이 <br>
어느 오브젝트에서 변경되거나 참조되는 것인지 해당 에셋을 확인하는 것만으로는 알 수 없기 때문이다. <br>
즉, 인스펙터 창에서 각 오브젝트들이 어떤 에셋을 활용하는지는 알 수 있어도, 반대는 불가능하다.<br></p><p>마지막으로, 스크립터블 오브젝트를 싱글턴으로 활용하는 것도 가능했다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SingletonScriptableObject&lt;T&gt; : ScriptableObject where T : SingletonScriptableObject&lt;T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static T instance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static T Instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (instance == null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                T[] assets = Resources.LoadAll&lt;T&gt;(&quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (assets == null || assets.Length &lt; 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    throw new System.Exception(&quot;Could not find any Scriptable Object Instances in the Resources.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else if (assets.Length &gt; 1) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Debug.LogWarning(&quot;Multiple Instances of Singleton Scriptable Object found in the Resources.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                instance = assets[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return instance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><a href="https://www.youtube.com/watch?v=6kWUGEQiMUI" target="_blank" rel="noopener noreferrer">Singleton Scriptable Object</a><br>
위의 스크립트를 상속하게 하여 Resources 폴더에 에셋을 생성하면, 싱글턴의 역할을 수행할 수 있다.<br>
앞서 언급했듯이, 스크립터블 오브젝트는 프로젝트 상에서 존재하므로, <br>
자연스럽게 DontDestroyOnLoad 싱글턴의 역할을 수행하게 된다.<br></p><p>나는 이 싱글턴 스크립터블 오브젝트를 UI 프리팹을 담는 컨테이너로 활용했다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public enum UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PopupOneButton = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PopupTwoButton,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PopupLine,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Setting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CreateAssetMenu(fileName = &quot;UI Container&quot;, menuName = &quot;Scriptable Objects/Singleton Asset/UI Container&quot;, order = 8)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UIContainer : SingletonScriptableObject&lt;UIContainer&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Order as UI Enum&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Tooltip(&quot;PopUpOneButton = 0\n&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &quot;PopUpTwoButton = 1\n&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &quot;PopUpLine = 2\n&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             &quot;Setting = 3&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameObject[] UI;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public delegate void ButtonDelegate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UIManager : DonDestroyOnLoadSingleton&lt;UIManager&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Dictionary&lt;UI, GameObject&gt; UIDictionary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OpenPopUpOneButton(string title, string uiContext, string buttonText, ButtonDelegate buttonDelegate = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupOneButton].SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupOneButton].transform.position = Vector3.zero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var popOne = UIDictionary[(int)UI.PopupOneButton].GetComponent&lt;UIPopUpOneButton&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        popOne.SetPopUpOneButton(title, uiContext, buttonText, buttonDelegate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OpenPopUpTwoButton(string title, string uiContext, string leftButton, string rightButton, ButtonDelegate leftButtonDelegate = null, ButtonDelegate rightButtonDelegate = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupTwoButton].SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupTwoButton].transform.position = Vector3.zero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var popTwo = UIDictionary[UI.PopupTwoButton].GetComponent&lt;UIPopUpTwoButton&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        popTwo.SetPopUpTwoButton(title, uiContext, leftButton, rightButton, leftButtonDelegate, rightButtonDelegate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OpenPopUpLine(string text, Vector3 position, float time)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupLine].SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var popLine = UIDictionary[UI.PopupLine].GetComponent&lt;UIPopUpLine&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        popLine.SetPopUpLine(text, position, time);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OpenSetting()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.Setting].SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void ClosePopUp(GameObject obj)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        obj.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new void Awake()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        base.Awake();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary = new Dictionary&lt;UI, GameObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; UIContainer.Instance.UI.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UIDictionary.Add((UI)i, Instantiate(UIContainer.Instance.UI[i]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UIDictionary[(UI)i].transform.SetParent(transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UIDictionary[(UI)i].SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GameObject 배열에 UI 프리팹들을 담고, 이를 필요에 따라 UIManager에서 불러와 활용했다.<br>
본래는 UIManager에서 UI 프리팹들과 이를 호출하는 메서드들을 모두 함께 가지고 있었는데,<br>
UI 프리팹을 지니는 오브젝트와 호출하는 오브젝트를 분리하는 것이 좋지 않을까 싶어서 이런 방식을 활용하게 되었다.</p><p>UIManager는 현재는 싱글턴 스크립터블 오브젝트의 형태로 작성하지는 않았지만, <br>
싱글턴 스크립터블 오브젝트로 변경해도 전혀 문제가 없을 것 같다.<br>
그렇게 하면 현재는 TitleScene에서 DontDestroyOnLoad로 생성되는 상태이기 때문에, <br>
다른 Scene에서 테스트가 필요해서 그 Scene에서 플레이모드로 전환한다면 따로 UIManager 프리팹을 Scene상에 선언해야 하는데,<br>
이러한 점을 신경 쓸 필요가 없이 다른 Scene에서도 편리한 테스트가 가능해지는 등의 이점이 생길 것 같다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="무한-맵-시스템">무한 맵 시스템<a aria-hidden="true" class="hash-link" href="#무한-맵-시스템" title="Direct link to heading">​</a></h3><p>플레이어가 특정 거리만큼 이동하면, 그에 맞춰서 맵의 위치를 조절하여 맵이 무한한 것처럼 보이게 했다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MapController : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Map Setting&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// TileMap Assign Order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 0 1 2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 3 4 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// 6 7 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Transform[] tiles;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BoxCollider2D centerCollider; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int centerToBorderOfOneTileMapSide = 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int sizeOfOneTileMapSide = 22;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int tileRow = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Map Border&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector2Variable mapBorderUpLeft;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector2Variable mapBorderDownRight;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Player Position&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3Variable playerPosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Awake()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        centerCollider = GetComponent&lt;BoxCollider2D&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mapBorderUpLeft.runtimeValue = new Vector2(-sizeOfOneTileMapSide * 1.5f, sizeOfOneTileMapSide * 1.5f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mapBorderDownRight.runtimeValue = new Vector2(sizeOfOneTileMapSide * 1.5f, -sizeOfOneTileMapSide * 1.5f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTriggerExit2D(Collider2D collision)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (collision.gameObject.CompareTag(&quot;Player&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CheckPlayerPosition();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void CheckPlayerPosition()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// Right: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (playerPosition.runtimeValue.x &gt; centerCollider.offset.x + centerToBorderOfOneTileMapSide) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MoveTiles(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderUpLeft.runtimeValue += Vector2.right * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderDownRight.runtimeValue += Vector2.right * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            centerCollider.offset += Vector2.right * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// Left: 1                                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (playerPosition.runtimeValue.x &lt; centerCollider.offset.x - centerToBorderOfOneTileMapSide) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MoveTiles(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderUpLeft.runtimeValue += Vector2.left * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderDownRight.runtimeValue += Vector2.left * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            centerCollider.offset += Vector2.left * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }                                                                                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// Up: 2                                                                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (playerPosition.runtimeValue.y &gt; centerCollider.offset.y + centerToBorderOfOneTileMapSide)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MoveTiles(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderUpLeft.runtimeValue += Vector2.up * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderDownRight.runtimeValue += Vector2.up * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            centerCollider.offset += Vector2.up * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// Down: 3                                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (playerPosition.runtimeValue.y &lt; centerCollider.offset.y - centerToBorderOfOneTileMapSide)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MoveTiles(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderUpLeft.runtimeValue += Vector2.down * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapBorderDownRight.runtimeValue += Vector2.down * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            centerCollider.offset += Vector2.down * sizeOfOneTileMapSide;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void MoveTiles(int direction)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Transform[] oldTiles = new Transform[tiles.Length];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Array.Copy(tiles, oldTiles, tiles.Length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (direction)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case 0: // Right</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (int i = 0; i &lt; tiles.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int reOrder = i % 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (reOrder == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // 기존 타일 배열의 인덱스 변경</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // (오브젝트 위치만 바뀌고 인덱스는 그대로 하기 위함)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i + 2] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // 타일 이동</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        oldTiles[i].position += sizeOfOneTileMapSide * tileRow * Vector3.right;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i - 1] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case 1: // Left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (int i = 0; i &lt; tiles.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int reOrder = i % 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (reOrder == 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i - 2] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        oldTiles[i].position += sizeOfOneTileMapSide * tileRow * Vector3.left;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i + 1] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case 2: // Up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (int i = 0; i &lt; tiles.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int reOrder = i + 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (reOrder &gt;= 9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i - 6] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        oldTiles[i].position += sizeOfOneTileMapSide * tileRow * Vector3.up;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i + 3] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case 3: // Down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (int i = 0; i &lt; tiles.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int reOrder = i - 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (reOrder &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i + 6] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        oldTiles[i].position += sizeOfOneTileMapSide * tileRow * Vector3.down;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        tiles[i - 3] = oldTiles[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>9개의 타일맵을 미리 생성해두고, 여기에 추가적으로 BoxCollider2D를 사용하여 플레이어의 이동을 감지하도록 했다.</p><p><img alt="무한맵 BoxCollider2D" src="/assets/images/UndeadSurvivor5-51140a3b7c781f83b3b8d20a52dbe740.jpg"><br>
플레이어가 일정 거리만큼 이동하여 Collider 바깥으로 벗어나면, 플레이어의 위치를 확인하여 그에 따라 맵이 이동한다.<br>
플레이어의 위치는 앞서 언급한 스크립터블 오브젝트 에셋을 활용한 방식으로 확인하기 때문에, <br>
플레이어를 직접 참조하지 않는다.</p><p>또한, 몬스터나 아이템이 전체 타일맵 내부에서 생성되도록 하였기 때문에, <br>
전체 맵의 경계를 담는 Vector2형의 데이터를 담는 스크립터블 오브젝트 mapBorderUpLeft와 mapBorderDownRight를 선언했다.<br>
위의 ObjectSpawner에서 이를 활용하는 코드를 확인할 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="플레이어-스킬-구현">플레이어 스킬 구현<a aria-hidden="true" class="hash-link" href="#플레이어-스킬-구현" title="Direct link to heading">​</a></h3><p>개발을 진행하면서 가장 복잡하지만 흥미로웠던 부분이 스킬을 구현하는 것이었다.<br>
아무래도 바로 눈으로 결과물을 확인하게 되기도 하고, 진짜 게임스러운 느낌도 나니 더더욱 와닿을 수밖에 없어 그런가보다.<br>
현재 게임에는 3가지의 스킬을 구현해 두었다. 나중에 뭔가 아이디어가 떠오르면 더 추가해볼수도 있을 것 같다.</p><p>우선 첫번째로는 회전하는 삽이다. 플레이어 주위를 빙빙 돌며 삽에 닿은 적에게 피해를 주는 스킬이다.<br>
기본적인 부분은 생략하고 가장 핵심인 부분만 보자면 바로 삽 각각의 위치와 방향을 설정하는 것이다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpinningShovel : GameEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Shovel&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] GameObject shovelPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable shovelDistanceFromPlayer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] List&lt;Transform&gt; shovels;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Skill Status&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] IntVariable shovelNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Other Setting&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3Variable playerPosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Transform locater;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetShovelsTransform()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Vector3&gt; points = new List&lt;Vector3&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Vector3 point = Vector3.zero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// 정n각형의 내각의 합은 180 * (n - 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// 정n각형의 각 내각은 180 * (n - 2) / n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int shovelDegree = 180 * (shovels.Count - 2) / shovels.Count;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; shovels.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            locater.Rotate(new Vector3(0f, 0f, 180 - shovelDegree));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            locater.Translate(Vector3.up * shovelDistanceFromPlayer.runtimeValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shovels[i].position = locater.position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            points.Add(locater.position);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            point += points[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Vector3 shovelCenter = point / shovels.Count;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Vector3 playerCenter = playerPosition.runtimeValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; shovels.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shovels[i].position += new Vector3(playerCenter.x - shovelCenter.x, playerCenter.y - shovelCenter.y, 0f);            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            float degree = Mathf.Atan2(playerCenter.y - shovels[i].position.y, playerCenter.x - shovels[i].position.x) * Mathf.Rad2Deg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shovels[i].rotation = Quaternion.Euler(new Vector3(0f, 0f, degree + 90));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetShovelNumber(int shovelNumber)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (shovels.Count &gt;= shovelNumber)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (shovels.Count &lt; shovelNumber)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GameObject newShovel = ObjectPooler.Instance.SpawnFromPool(&quot;Shovel&quot;, transform.position, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shovels.Add(newShovel.transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newShovel.transform.SetParent(transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            newShovel.transform.SetAsLastSibling();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shovelDistanceFromPlayer.runtimeValue -= 0.2f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.shovelNumber.runtimeValue = shovelNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SetShovelsTransform();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="삽의 위치" src="/assets/images/UndeadSurvivor3-ff3ff7fd7601e003da28baed10b26e52.jpg"></p><p>삽의 위치는 플레이어를 중심으로 정다각형이 되도록 해야 하고, 방향은 각 꼭지점을 기준으로 바깥쪽을 향하게 해야 한다.<br>
이 부분을 어떻게 구현할까 고민을 꽤 많이 했었다.<br>
애초에 가장 막힌 부분은 어떻게 하면 플레이어를 중심으로 정다각형이 되도록 삽을 배치하는 것인가였다.<br>
결국 최대한 단순하게 해결하기로 했다.</p><p>위의 코드에서 볼 수 있듯이 locator라는 빈 오브젝트를 하나 생성하였다.<br>
그리고 locator가 정다각형의 형태로 이동하며, locator가 각 꼭지점으로 이동할 때마다 삽을 배치하는 것이다.<br>
그 후, 모든 삽의 위치를 모든 삽의 위치값의 평균과 플레이어의 위치의 차이만큼 이동시키면<br>
삽이 플레이어를 중심으로 정다각형의 형태를 띄게 된다.</p><p>그리고 삽의 방향을 설정하는 것은 Mathf에서 제공하는 역삼각함수 Atan2를 이용하여 해결했다.</p><p>그 다음으로는 자동총과 옥수수 폭탄을 만들었다.<br>
두 스킬은 원리가 거의 비슷하므로 자동총 하나만 설명하려고 한다.<br>
단지 공격 범위가 단일 대상이냐, 범위 공격이냐의 차이만 있을 뿐 작동 방식은 같다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AutoGun : GameEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Bullet&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] GameObject bulletPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Transform bulletFirePosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Bullet Status&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable bulletDamage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable bulletSpeed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable bulletShotDelay;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] IntVariable bulletMultiple;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;Other Setting&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3Variable playerPosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable monsterDetectionRange;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Unity Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Response.AddListener(DeActivate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StartCoroutine(FireBullet(bulletMultiple.runtimeValue));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IEnumerator FireBullet(int bulletNumber)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int centerBullet = Mathf.RoundToInt(bulletMultiple.runtimeValue / 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Collider2D monsterInRange = Physics2D.OverlapCircle(playerPosition.runtimeValue, monsterDetectionRange.runtimeValue, 1 &lt;&lt; LayerMask.NameToLayer(&quot;Monster&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (monsterInRange != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Vector3 direction = monsterInRange.transform.position - bulletFirePosition.position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (int i = 0; i &lt; bulletMultiple.runtimeValue; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    GameObject bulletInPool = ObjectPooler.Instance.SpawnFromPool(&quot;Bullet&quot;, bulletFirePosition.position, Quaternion.identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Bullet bullet = bulletInPool.GetComponent&lt;Bullet&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    float revisedDegree = (i - centerBullet) / 2f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (bullet != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        bullet.SetBullet(direction + Vector3.right * revisedDegree);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            yield return new WaitForSeconds(bulletShotDelay.runtimeValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Bullet : MonoBehaviour, IPooledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable bulletDamage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] FloatVariable bulletSpeed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Vector3 direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] float bulletRemainingTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Unity Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transform.position += bulletSpeed.runtimeValue * Time.deltaTime * direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTriggerEnter2D(Collider2D collision)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (collision.gameObject.CompareTag(&quot;Monster&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            collision.gameObject.GetComponent&lt;Monster&gt;().GetDamage(bulletDamage.runtimeValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectPooler.Instance.InsertToPool(&quot;Bullet&quot;, gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IEnumerator ReturnToPool()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yield return new WaitForSeconds(bulletRemainingTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ObjectPooler.Instance.InsertToPool(&quot;Bullet&quot;, gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetBullet(Vector3 direction)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float degree = Mathf.Atan2(-direction.y, -direction.x) * Mathf.Rad2Deg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, degree + 90));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.direction = direction.normalized;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnObjectSpawn()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StartCoroutine(ReturnToPool());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnObjectInsert() { }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>자동총의 구현은 회전삽보다 훨씬 빠르게 끝났다.</p><p>가장 핵심은 플레이어 주변의 적을 찾아내서 해당 위치로 총을 발사하는 것이었다.<br>
그렇기 때문에 Physics2D.OverlapCircle로 원형 범위 내의 Layer가 Monster인 적을 찾아냈다.<br>
다만, 게임을 시작하고 바로 자동총을 선택하거나 하는 상황에, <br>
감지 범위 내에 적이 아무도 없으면 NullReferenceException이 발생하고 총이 작동을 멈추기 때문에<br>
이를 방지하기 위해 null 체크를 한번 진행하도록 했다.</p><p>그리고 총알을 오브젝트 풀에서 꺼내와 해당 오브젝트의 SetBullet을 통해 각도와 방향을 설정하고 발사시킨다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">float revisedDegree = (i - centerBullet) / 2f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (bullet != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bullet.SetBullet(direction + Vector3.right * revisedDegree);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>이 부분의 경우, 한번에 발사되는 총알의 개수를 늘릴 수 있는 효과가 존재하기 때문에<br>
해당 효과에 따라 총알 수가 늘어날 경우 각 총알의 각도와 방향을 조금씩 다르게 설정하기 위함이다.</p><p>옥수수 폭탄의 경우도 Physics2D.OverlapCircle로 적을 감지하고 폭탄을 던지는 것은 비슷하다.<br>
다만 범위 공격이기 때문에 옥수수 폭탄이 적에게 닿았을 경우, <br>
다시 Physics2D.OverlapCircleAll을 통해 범위 내 모든 적을 감지하고 데미지를 주는 정도의 차이가 있을 뿐이다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ui">UI<a aria-hidden="true" class="hash-link" href="#ui" title="Direct link to heading">​</a></h3><p>사실 UI에 대한 전반적인 설명이라기보다는 특정 UI 하나를 만드는 데 고민을 많이 했었다.<br>
UI에 대한 전반적인 설명은 간략하게 하고 넘어가려고 한다.<br>
게임을 만들면서 UI를 크게 2가지로 구분했다.<br>
어떤 Scene에서든 필요하다고 생각되는 UI와, 특정 Scene에서만 필요하다고 생각되는 UI로 나누었다.<br></p><p>어떤 Scene에서든 필요한 UI라면 싱글턴 스크립터블 오브젝트, DontDestroyOnLoad 등 어떤 방식으로든 준비해두어야 하지만<br>
특정 Scene에서만 필요한 UI라면 그런 방식이 오히려 낭비이고, 그냥 필요한 Scene에 미리 배치해두면 되기 때문이다.</p><p>공용 UI의 예시는 아래와 같다.<br>
<img alt="UI_PopUpTwoButton" src="/assets/images/UndeadSurvivor8-255c994a8909ec6b77a4ed0e5985bf53.jpg"></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using TMPro;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// 두 개의 버튼이 있는 팝업창 UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UIPopUpTwoButton : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TextMeshProUGUI titleString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TextMeshProUGUI uiContextString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TextMeshProUGUI leftButtonString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TextMeshProUGUI rightButtonString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ButtonDelegate leftButtonDelegate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ButtonDelegate rightButtonDelegate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetPopUpTwoButton(string title, string uiContext, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  string leftButton, string rightButton, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  ButtonDelegate leftButtonDelegate = null, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  ButtonDelegate rightButtonDelegate = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        titleString.text = title;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uiContextString.text = uiContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        leftButtonString.text = leftButton;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.leftButtonDelegate = leftButtonDelegate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rightButtonString.text = rightButton;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.rightButtonDelegate = rightButtonDelegate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnPressLeftButton()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (leftButtonDelegate != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            leftButtonDelegate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UIManager.Instance.ClosePopUp(gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void OnPressRightButton()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (rightButtonDelegate != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rightButtonDelegate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UIManager.Instance.ClosePopUp(gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ButtonDelegate는 UIManager와 동일한 스크립트에 선언된 void형 델리게이트이다.<br>
이를 호출하는 방법은 위의 UIManager 코드에도 나와있지만 짧게 다시 한번 정리하자면 아래와 같다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public void OpenPopUpTwoButton(string title, string uiContext, string leftButton, string rightButton, ButtonDelegate leftButtonDelegate = null, ButtonDelegate rightButtonDelegate = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupTwoButton].SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIDictionary[UI.PopupTwoButton].transform.position = Vector3.zero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var popTwo = UIDictionary[UI.PopupTwoButton].GetComponent&lt;UIPopUpTwoButton&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        popTwo.SetPopUpTwoButton(title, uiContext, leftButton, rightButton, leftButtonDelegate, rightButtonDelegate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>공용 UI이므로 UIContainer라는 싱글턴 스크립터블 오브젝트에서 멤버로서 선언하고 있다.<br>
(공용 UI들은 모두 UIContainer에 멤버로 들어가 있다)<br></p><p>그 다음으로는 설정창 UI이다.<br>
설정창에 사운드 조절 말고 딱히 더 추가할 기능이 떠오르지 않아서 아직 사운드 조절 기능밖에 없다.<br>
<img alt="UISetting" src="/assets/images/UndeadSurvivor9-2d49f824b83557e78cbf1f04d68ae44c.jpg"></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using TMPro;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// 설정창 UI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UISetting : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] TextMeshProUGUI volumeText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetVolume(float volume)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (volume == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SoundManager.Instance.SetVolume(-80f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            volumeText.text = &quot;X&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SoundManager.Instance.SetVolume(volume);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeText.text = string.Format(&quot;{0:###}&quot;, (volume * 100));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void CloseButton()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UIManager.Instance.ClosePopUp(gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>설정창 UI에 있는 Slider를 조절하면 SetVolume()을 호출하여 SoundManager가 AudioMixer의 볼륨을 조절한다.<br>
사실 기타 UI들은 모두 단순해서 별 고민 없이 빠르게 완성할 수 있었다.<br></p><p>그렇게 고민을 했던 특정 UI란 바로 스킬 선택창이다.</p><p><img alt="UISkillSelect" src="/assets/images/UndeadSurvivor10-42f31b910c953c363303de7238a06a8f.jpg"></p><p>게임 시작시에 처음으로 스킬 선택창을 보여주고, 스킬 중 하나를 고르도록 했다.<br>
스킬이 아예 없다면 적을 사냥할 방법이 없고, 그러면 경험치를 획득할 수 없으니 게임 진행이 거의 불가능하니 말이다.<br>
그 다음부터 스킬 선택창이 뜨면 보유중인 스킬의 강화 효과 + 아직 발동하지 않은 스킬을 발동하는 효과로<br>
랜덤하게 선택지를 보이도록 하려 했다.</p><p>다만 여기서 선택지를 선정하고 랜덤하게 보여주는 데 뭔가 더 효율적인 방법이 있지 않을까 하는 생각을 많이 했는데,<br>
결국에는 계속 고민하기보다는 일단 무조건 만드는 것으로 마음을 먹었다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UISkillSelect : GameEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] List&lt;AutoGunUpgrade&gt; autoGunUpgradeList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] List&lt;CornThrowerUpgrade&gt; cornThrowerUpgradeList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] List&lt;SpinningShovelUpgrade&gt; spinningShovelUpgradeList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] SkillSelectButton[] selectButtons;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool isFirstSelect;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new void OnEnable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        base.OnEnable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SetSkillSelectUI();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Time.timeScale = 0f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Response.AddListener(DeActivate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void DeActivate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Time.timeScale = 1f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gameObject.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetSkillSelectUI()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// 추첨할 리스트 객체 선언</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;SkillUpgrade&gt; upgradeList = new List&lt;SkillUpgrade&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!isFirstSelect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(autoGunUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(cornThrowerUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(spinningShovelUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isFirstSelect = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; selectButtons.Length; i++) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                selectButtons[i].SetSkillButtonSlot(upgradeList[i]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!GameObject.FindGameObjectWithTag(&quot;AutoGun&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(autoGunUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 1; i &lt; autoGunUpgradeList.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                upgradeList.Add(autoGunUpgradeList[i]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!GameObject.FindGameObjectWithTag(&quot;CornThrower&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(cornThrowerUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 1; i &lt; cornThrowerUpgradeList.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                upgradeList.Add(cornThrowerUpgradeList[i]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!GameObject.FindGameObjectWithTag(&quot;SpinningShovel&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.Add(spinningShovelUpgradeList[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 1; i &lt; spinningShovelUpgradeList.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                upgradeList.Add(spinningShovelUpgradeList[i]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; selectButtons.Length; i++) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int random = Random.Range(0, upgradeList.Count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            selectButtons[i].SetSkillButtonSlot(upgradeList[random]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            upgradeList.RemoveAt(random);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>사실 이 UI 스크립트가 그렇게 썩 마음에 들지는 않는다.<br>
그럼에도 불구하고, 현재로서는 아무 문제 없이 잘 작동한다.</p><p>맘에 안드는 부분이 있다면, UI를 만들 때 가급적이면 실제 데이터와 분리해서 만드려고 신경을 좀 쓴 부분이 있다.<br>
그런데 이 UI에서는 이런 점을 완전히 무시한다.<br>
스킬 업그레이드 선택지는 모두 스크립터블 오브젝트로 제작되어 있다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class SkillUpgrade : ScriptableObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Sprite image;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string description;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected abstract void Effect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract void OnSelect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>SkillUpgrade 추상 스크립터블 오브젝트 클래스를 상속하여</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class AutoGunUpgrade : SkillUpgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] protected FloatVariable bulletDamage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] protected FloatVariable bulletShotDelay;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] protected IntVariable bulletMultiple;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>이와 같이 각 스킬의 업그레이드인 추상 클래스를 제작하고,<br>
다시 이 추상 클래스를 상속하여</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CreateAssetMenu(fileName = &quot;AutoGun Damage Increase&quot;, menuName =&quot;Scriptable Objects/Skill/AutoGun/Damage Increase&quot;, order = 1)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AutoGunDamageIncrease : AutoGunUpgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] float increaseAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override void OnSelect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Effect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void Effect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bulletDamage.runtimeValue += increaseAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>이렇게 실질적인 효과가 있는 스크립터블 오브젝트를 만들고, <br>
이를 에셋으로 생성하여 위의 UISkillSelect의 각 스킬에 해당되는 List에 집어넣었다.</p><p>이러면 UI가 실질적인 데이터를 멤버로 지니게 되기 때문에, 이러한 부분이 맘에 들지 않았다.<br>
다만, 이런 부분을 신경 쓴 이유가 UI들이 어떠한 데이터에 종속되지 않게 하고 싶어서였는데<br>
UISkillSelect의 경우는 게임 Scene에서만 존재하고, 이 데이터들을 게임의 다른 부분에서 쓸 일이 (일단은) 없으므로<br>
당장은 이렇게 만들기로 타협을 했다.</p><p>UISkillSelect의 작동 방식은, 처음 스킬을 선택하는지 확인하고, <br>
첫 선택인 경우 각 스킬을 발동시키는 효과들만 리스트에 담아서 랜덤하게 3개를 보여준다.<br>
다만, 지금 당장 게임에 구현된 스킬이 3가지뿐이므로 현재로선 큰 의미는 없지만 말이다.<br>
나중에 스킬을 더 추가하면 의미가 생길 것이다.</p><p>그 이후에 스킬 선택창이 다시 호출되는 경우, 그때는 Scene에 존재하는 스킬들을 확인한다.</p><p>활성화되지 않은 스킬은 GameObject.FindGameObjectWithTag()로 찾아내지지 않기 때문에,<br>
오브젝트 풀에 각 스킬들이 들어가 있다 해도 활성화 되어있지 않기에 찾아지지 않는다.</p><p>그렇게 존재하는 스킬을 확인하면, SetSkillSelectUI 메서드 내부의 선택지 리스트인 upgradeList를 세팅한다.<br>
이미 존재하는, 즉 플레이어가 사용 중인 스킬이라면 해당 스킬의 강화 효과를 리스트에 넣는다.<br>
그러나 플레이어가 사용 중이지 않은 스킬이 있다면, 해당 스킬을 발동하는 효과만 리스트에 넣는다.<br>
예를 들어서, AutoGun은 발동 중인데, CornThrower와 SpinningShovel은 발동 중이지 않다면,<br>
AutoGunUpgrade 리스트에서는 0번 인덱스 외의 모든 요소들이 upgradeList에 추가되고,<br>
CornThrower와 SpinningShovel에서는 0번 인덱스의 요소만 upgradeList에 추가된다.<br>
(각 List의 0번 인덱스에 해당 스킬의 발동 효과가 들어가도록 인스펙터에서 설정을 해뒀다) </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="google-admob">Google AdMob<a aria-hidden="true" class="hash-link" href="#google-admob" title="Direct link to heading">​</a></h3><p>마지막으로는 구글의 AdMob 서비스를 활용하여 게임 타이틀 화면에 배너형 광고를 하나 달아두었다.<br>
구글 AdMob 가입 및 앱 등록 자체는 굉장히 간단하므로 자세히 남기지는 않으려 한다.</p><p>요즘 AdMob의 배너형 광고는 &#x27;적응형 배너&#x27;라는 것을 권장하는 것 같다.<br>
처음에는 타이틀 화면뿐 아니라 게임 결과창에서도 광고를 노출시킬까 싶어서 싱글턴 스크립터블 오브젝트로 설계했는데,<br>
일단은 타이틀 화면에서만 광고를 노출시키고 있는 상태다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using GoogleMobileAds.Api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Sample App ID: ca-app-pub-3940256099942544~3347511713</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CreateAssetMenu(fileName = &quot;AdMob Banner&quot;, menuName = &quot;Scriptable Objects/AdMob/Banner&quot;, order = 0)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AdMobBanner : SingletonScriptableObject&lt;AdMobBanner&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readonly string unitID = &quot;실제 광고단위 ID&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readonly string testUnitID = &quot;ca-app-pub-3940256099942544/6300978111&quot;; // 테스트용 배너 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readonly string testDeviceID = &quot;테스트 기기용 ID&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BannerView banner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AdPosition position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void InitAd()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string id = Debug.isDebugBuild ? testUnitID : unitID;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int adWidth = MobileAds.Utils.GetDeviceSafeWidth();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AdSize adSize = AdSize.GetCurrentOrientationAnchoredAdaptiveBannerAdSizeWithWidth(adWidth);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        banner = new BannerView(id, adSize, position);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AdRequest request = new AdRequest.Builder().Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        banner.LoadAd(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void ShowAd()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        banner.Show();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void HideAd()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        banner.Hide();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetTestDeviceID()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;string&gt; deviceID = new List&lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            testDeviceID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestConfiguration requestConfiguration = new RequestConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .Builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .SetTestDeviceIds(deviceID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MobileAds.SetRequestConfiguration(requestConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetTestDeviceID(string testDeviceID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;string&gt; deviceID = new List&lt;string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deviceID.Add(testDeviceID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestConfiguration requestConfiguration = new RequestConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .Builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .SetTestDeviceIds(deviceID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MobileAds.SetRequestConfiguration(requestConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SetTestDeviceIDs(List&lt;string&gt; testDeviceIDs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;string&gt; deviceIDs = new List&lt;string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; testDeviceIDs.Count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            deviceIDs.Add(testDeviceIDs[i]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestConfiguration requestConfiguration = new RequestConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .Builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .SetTestDeviceIds(deviceIDs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MobileAds.SetRequestConfiguration(requestConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c#"><pre tabindex="0" class="prism-code language-c# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using GoogleMobileAds.Api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using TMPro;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.EventSystems;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Title : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MobileAds.Initialize((initStatus) =&gt; { });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AdMobBanner.Instance.SetTestDeviceID();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AdMobBanner.Instance.InitAd();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AdMobBanner.Instance.ShowAd();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Input.GetMouseButtonDown(0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!EventSystem.current.IsPointerOverGameObject())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                AdMobBanner.Instance.HideAd();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                LoadSceneManager.LoadScene(SceneState.Game);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>성공적으로 광고를 적용시켰다면 에디터 상에서 아래와 같이 테스트 광고가 출력된다.<br>
<img alt="AdMob Banner" src="/assets/images/UndeadSurvivor6-ed30d061fb2ccc6d5048318401bbf413.jpg"><br></p><p>다만, 에디터상에서 말고 실제로 AdMob을 적용하고 빌드하는 과정에서 문제가 생긴 적이 있었다.<br>
그 전까지는 정상적으로 빌드되었기 때문에 꽤나 당황스러웠다.</p><p><code>Configure project :launcher WARNING: The option &#x27;android.enableR8&#x27; is deprecated and should not be used anymore. It will be removed in a future version of the Android Gradle plugin, and will no longer allow you to disable R8.</code></p><p>이런 문제점이 발생한 적이 있는데, 여러 곳을 둘러보다가 결국 찾은 해결법은 생각보다 단순했다.<br>
이것 말고도 다른 여러 개발자들이 각자 방법으로 문제를 해결했다고 했지만, 나에게 통한 것은 이것이었다.</p><p><a href="https://stackoverflow.com/questions/73525188/the-option-android-enabler8-is-deprecated-and-should-not-be-used-anymore-it-w" target="_blank" rel="noopener noreferrer">Admob 문제 해결</a></p><p>위에서 찾은 대로 프로젝트 폴더상의 Library\Bee\Android 폴더를 삭제하고, <br>
에디터에서 Asset\External Dependency Manager\Android Resolver\Force Resolve를 실행하니 빌드가 정상적으로 진행됐다.<br>
아직까지 정확히 왜 이런 문제가 발생했는지는 모르겠다.<br>
다만 추측을 해보자면, AdMob 패키지를 Import하는 과정에서 <br>
기존에 유니티에 있던 안드로이드 SDK와 일종의 버전 충돌이 난 것이 아닌가 하는 생각이 든다.</p><p>또한 주의해야 할 점은, AdMob은 아무래도 광고를 통해 수익을 창출하는 곳이므로 사용 규칙이 엄격하다.<br>
실제 모바일 기기에서 실제 광고 단위 ID로 광고가 잘 작동하나 테스트하기 전에, <br>
해당 디바이스를 꼭 테스트 기기로 등록해두는 것이 좋다.</p><p>모바일 기기를 컴퓨터에 연결하고, Android SDK - platform tools의 adb.exe가 있는 곳에서 powershell을 열고<br>
모바일 기기로 광고 테스트를 하려는 게임을 켠 다음, .\adb.exe logcat -s Unity Ads 명령어를 사용하여 테스트 ID를 알아내어<br>
위의 SetTestDeviceID()와 같은 방식으로 꼭 테스트용 기기임을 알려야 한다.<br>
그렇지 않고 테스트 용도라도 실제 출력된 광고를 눌렀다간 약관 위반으로 이용이 제한될 수 있다.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/unity">Unity</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/portfolio">Portfolio</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/undead-survivor">UndeadSurvivor</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Despria/Despria.github.io/docs/Programming/Unity/Portfolio/UndeadSurvivor.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Programming/programming_intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->프로그래밍 관련 문서</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Programming/Unity/Unity_Basic_1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Unity를 위한 기본 문법 1<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#게임-기본-구성" class="table-of-contents__link toc-highlight">게임 기본 구성</a><ul><li><a href="#loading-scene" class="table-of-contents__link toc-highlight">Loading Scene</a></li><li><a href="#오브젝트-풀링-object-pooling" class="table-of-contents__link toc-highlight">오브젝트 풀링 (Object Pooling)</a></li><li><a href="#스크립터블-오브젝트-scriptable-object-적극-활용" class="table-of-contents__link toc-highlight">스크립터블 오브젝트 (Scriptable Object) 적극 활용</a></li><li><a href="#무한-맵-시스템" class="table-of-contents__link toc-highlight">무한 맵 시스템</a></li><li><a href="#플레이어-스킬-구현" class="table-of-contents__link toc-highlight">플레이어 스킬 구현</a></li><li><a href="#ui" class="table-of-contents__link toc-highlight">UI</a></li><li><a href="#google-admob" class="table-of-contents__link toc-highlight">Google AdMob</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documents</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Despria" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.084d969c.js"></script>
<script src="/assets/js/main.9d55d610.js"></script>
</body>
</html>