<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Despria의 블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Despria의 블로그 Atom Feed"><title data-react-helmet="true">Object Pooling | Despria의 블로그</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://Despria.github.io/docs/Programming/Unity/ObjectPooling_1"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Object Pooling | Despria의 블로그"><meta data-react-helmet="true" name="description" content="오브젝트 풀링이라고 불리는 기법은 게임 프로그래밍에 있어서 기초적이면서도 필수적인 기법이다."><meta data-react-helmet="true" property="og:description" content="오브젝트 풀링이라고 불리는 기법은 게임 프로그래밍에 있어서 기초적이면서도 필수적인 기법이다."><link data-react-helmet="true" rel="shortcut icon" href="/img/VeronicaSD.ico"><link data-react-helmet="true" rel="canonical" href="https://Despria.github.io/docs/Programming/Unity/ObjectPooling_1"><link data-react-helmet="true" rel="alternate" href="https://Despria.github.io/docs/Programming/Unity/ObjectPooling_1" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://Despria.github.io/docs/Programming/Unity/ObjectPooling_1" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3f82f11a.css">
<link rel="preload" href="/assets/js/runtime~main.54a63bd4.js" as="script">
<link rel="preload" href="/assets/js/main.e0c2ea69.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/VeronicaSD.webp" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/VeronicaSD.webp" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Despria의 블로그</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documents</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Programming</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/programming_intro">프로그래밍 관련 문서</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Unity</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Portfolio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_1">Unity를 위한 기본 문법 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_2">Unity를 위한 기본 문법 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_3">Unity를 위한 기본 문법 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/Unity_Basic_4">Unity를 위한 기본 문법 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Programming/Unity/ObjectPooling_1">Object Pooling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_1">AssetBundle 빌드하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_2">AssetBundle로부터 오브젝트 불러오기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Programming/Unity/AssetBundle_3">AssetBundle 사용 시 주의사항</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Programmers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Games</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Documents</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Object Pooling</h1></header><p><strong>오브젝트 풀링</strong>이라고 불리는 기법은 게임 프로그래밍에 있어서 기초적이면서도 필수적인 기법이다.</p><p>유니티에서 오브젝트를 새로 생성하고, 파괴하는 행위는 생각보다 많은 연산을 필요로 한다.<br>
물론 그 수가 많지 않을 경우에는 그래도 컴퓨터가 간단하게 처리해낼 수 있지만,<br>
예를 들어서 탄막 슈팅 게임 등에서 총알 오브젝트를 생성한다고 가정할 경우, 그 수가 상당하기 때문에<br>
여러 오브젝트가 생성되고 파괴된 이후, GC가 작동할 가능성이 매우 높아지며, 이는 필연적인 속도 저하로 이어지게 된다.<br>
게임을 한창 플레이 하는 도중의 프레임 저하는, 게임을 즐기는 사람들이라면 누구나 공감하겠지만<br>
잠깐이라 할지라도 꽤 불쾌한 경험을 안겨다주며, 또 게임 장르에 따라선 실제 플레이에 큰 지장을 주기 때문에<br>
최대한 일어나지 않도록 해야 하는 현상이다.</p><p>이러한 현상을 최소화하고자 사용하는 패턴이 바로 오브젝트 풀링이다.<br>
오브젝트 풀링은 미리 여러 개의 오브젝트를 생성해두고, 해당 오브젝트가 필요한 상황에 이를 사용한 다음,<br>
오브젝트가 파괴되야하는 상황에 이를 파괴하는 대신, 다시 저장해두었다가 사용할 수 있도록 만드는 것이다.</p><p><img alt="Object Pooling 예시" src="/assets/images/objectpooling1-a1faa9d4abdb23e88251b5f1c946bc4a.png"></p><p>위의 예시 사진처럼, 여러 개가 필요할 것 같은 오브젝트를 미리 생성해두고 SetActive를 false로 해둔 다음,<br>
필요한 상황에 다시 SetActive를 true로 만들어서 사용한다.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="object-pooling-구현">Object Pooling 구현<a aria-hidden="true" class="hash-link" href="#object-pooling-구현" title="Direct link to heading">​</a></h2><p>오브젝트 풀링은 단지 명칭일 뿐, 이를 실제로 구현하는 방법은 여러 가지가 존재한다.<br>
이 글에서는 그 중 몇 가지 방법을 소개하고자 한다.<br></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-delegate를-이용한-object-pooling-구현">1. delegate를 이용한 Object Pooling 구현<a aria-hidden="true" class="hash-link" href="#1-delegate를-이용한-object-pooling-구현" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GameObjectPool&lt;T&gt; where T : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 객체를 반환해줄 델리게이트</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public delegate T Func();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Queue&lt;T&gt; objectPool = new Queue&lt;T&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int count;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Func createFunc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Constructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 오브젝트 풀 생성자</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // count를 통해 큐의 크기를, createFunc을 통해 객체를 받아옴</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameObjectPool(int count, Func createFunc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.count = count;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.createFunc = createFunc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Allocate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 큐에 지정된 객체를 저장(초기화)하는 메서드</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Allocate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            objectPool.Enqueue(createFunc());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 큐에 저장된 객체를 불러오는 메서드</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 단, 큐에 저장된 것보다 더 많은 객체가 필요할 경우, 임시로 객체를 생성함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public T Get()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (objectPool.Count &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return objectPool.Dequeue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return createFunc();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 큐에 지정된 객체를 저장하는 메서드</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Set(T obj)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectPool.Enqueue(obj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>GameObjectPool 클래스는 제네릭 지정자를 사용하였다.<br>
T에 풀로 생성하고자 하는 오브젝트에 붙은 스크립트를 지정하면 해당 오브젝트의 풀을 생성할 수 있다.<br>
또한, 내부에 하나의 Queue를 선언해두었는데, 오브젝트 풀은 보통 큐를 이용하여 구현하기 때문이다.<br>
count는 오브젝트 풀의 크기를, createFunc는 오브젝트 풀에 넣을 오브젝트를 반환하는 델리게이트 메서드이다.</p><p>작동 방식은 생성자를 통해 매개변수 count와 createFunc를 넘겨주면, <br>
이를 통해 GameObjectPool의 count와 createFunc을 초기화하고,<br>
count의 수만큼 Allocate를 반복 실행하여 createFunc()의 반환값인 오브젝트를 저장하는 것이다.</p><p>또한 Get과 Set을 통해 각각 오브젝트 풀에서 오브젝트를 요청 또는 반환할 수 있다.<br>
만약 Get을 통해 얻어올 오브젝트가 풀에 존재하지 않는다면, 새로 생성한다.</p><p>이를 실제로 활용하는 코드 예시는 아래와 같다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class HeroController : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 총알 제어 변수</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] Transform firePosition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SerializeField] GameObject bulletPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GameObjectPool&lt;BulletController&gt; bulletPool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // bulletPool에서 총알을 꺼내와 활성화 상태로 만들고 위치를 지정함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void CreateBullet()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var bullet = bulletPool.Get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bullet.gameObject.SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bullet.transform.position = firePosition.position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 사용한 총알을 비활성화 시키고 다시 풀에 집어넣음</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void RemoveBullet(BulletController bullet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bullet.gameObject.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bulletPool.Set(bullet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 오브젝트 풀에 10개의 총알을 만들어 비활성화 상태로 저장</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // obj에서 총알 프리팹을 인스턴스화하고, 비활성화 상태로 둠</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // bullet에서 총알 객체의 BulletController를 접근할 수 있게 함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // InitBullet을 통해 생성된 총알 객체의 BulletController에서도 HeroController를 접근할 수 있게 함</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bulletPool = new GameObjectPool&lt;BulletController&gt;(10, () =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var obj = Instantiate(bulletPrefab);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            obj.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var bullet = obj.GetComponent&lt;BulletController&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bullet.InitBullet(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return bullet;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        InvokeRepeating(&quot;CreateBullet&quot;, 1f, 0.2f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>HeroController의 Start()에서 오브젝트 풀을 생성하는 모습을 확인할 수 있다.<br>
bulletPrefab에 지정해둔 오브젝트를 생성 및 비활성화 후, 해당 오브젝트의 BulletController 컴포넌트를 반환한다.</p><p>CreateBullet()에서는 오브젝트 풀에서 오브젝트를 꺼내와 활성화 시키는 동작을 수행하며,<br>
RemoveBullet()은 반대로 오브젝트를 비활성화 시키고 풀에 집어넣는 동작을 수행한다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BulletController : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HeroController hero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Remove()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hero.RemoveBullet(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void InitBullet(HeroController hero)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.hero = hero;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnEnable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (IsInvoking(&quot;Remove&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CancelInvoke(&quot;Remove&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Invoke(&quot;Remove&quot;, 3f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTriggerEnter2D(Collider2D collision)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (collision.CompareTag(&quot;Monster&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var mon = collision.gameObject.GetComponent&lt;MonsterController&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mon.SetDamage(attack);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>BulletController에서는 오브젝트가 Monster 태그를 지닌 적과 부딪히거나, 활성화 후 3초가 지났을 때,<br>
HeroController의 RemoveBullet()을 호출하여 오브젝트 풀로 되돌아가도록 하고 있다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-unityenginepool을-통한-object-pooling-구현">2. UnityEngine.Pool을 통한 Object Pooling 구현<a aria-hidden="true" class="hash-link" href="#2-unityenginepool을-통한-object-pooling-구현" title="Direct link to heading">​</a></h3><p><a href="https://www.youtube.com/watch?v=v-p0o9KavkI" target="_blank" rel="noopener noreferrer">retr0 - 유니티 오브젝트 풀링 1/2</a></p><p><a href="https://www.youtube.com/watch?v=0AFb2hizXVU" target="_blank" rel="noopener noreferrer">retr0 - 유니티 오브젝트 풀링 2/2</a></p><p>유명한 유니티 입문서인 &#x27;레트로의 유니티 게임 프로그래밍 에센스&#x27;의 저자이신 retr0 이재민님의 영상에서 배운 내용이다.<br> </p><p>아무래도 오브젝트 풀링이라는 것이 게임 제작에서 굉장히 많이 사용되는 기법이니만큼,<br>
2021 LTS버전부터는 아예 유니티가 UnityEngine.Pool이라는 namespace를 추가하고 기능을 제공하기 시작했다.</p><p>UnityEngine.Pool에서 제공하는 오브젝트 풀은 두 가지의 메서드를 사용한다.<br>
그것은 바로 <strong>Get</strong>과 <strong>Release</strong>다.<br>
Get은 오브젝트 풀에서부터 오브젝트를 가져오는 것, 즉 요청하는 것이고,<br>
Release는 오브젝트 풀로 오브젝트를 반환하는 것, 즉 해제하는 것이다.</p><p><img alt="UnityEngine.ObjectPool - Get()" src="/assets/images/objectpooling2-aa47b22637409f4be5b23870bf8c8629.png"></p><p>Get은 풀에 오브젝트가 없을 경우, 해당 오브젝트를 새로 생성하여 건네준다.<br>
풀에 남은 오브젝트가 존재한다면, 당연히 풀에 남아있는 오브젝트를 건네준다.</p><p><img alt="UnityEngine.ObjectPool - Release()" src="/assets/images/objectpooling3-0c59601315f9a2f46f69fabe71995018.png"></p><p>Release는 풀에 남아 있는 공간이 있을 경우, 풀에 오브젝트를 집어넣지만,<br>
만약 남은 공간이 없다면, 해제하려는 오브젝트를 그대로 파괴한다.</p><p><img alt="UnityEngine.ObjectPool - Pool" src="/assets/images/objectpooling4-d6c68ace7d779958e0962d9d4ee63ed0.png"></p><p>UnityEngine.Pool의 오브젝트 풀은 처음 생성 시 최대 크기를 지정하도록 되어 있다.<br>
위의 그림과 같이 최대 5개의 오브젝트를 보관할 수 있는 풀을 생성헀다고 가정해보자.<br>
이 때, 지금 풀은 비어있는 상태이므로 Get()을 호출 시, 오브젝트를 새로 생성하여 건네준다.</p><p><img alt="UnityEngine.ObjectPool - Pool" src="/assets/images/objectpooling8-a58481a1621c513e405c920e676a6098.png"></p><p>위의 그림처럼 남아있는 오브젝트가 있다면, Get() 호출 시 당연히 이미 존재하는 오브젝트를 건네준다.</p><p><img alt="UnityEngine.ObjectPool - Pool" src="/assets/images/objectpooling6-3c5939105368bc2a3776f9c4610df61e.png"></p><p>Release()의 경우도 비슷한데, 풀에 남아있는 공간이 있는 상태에서 Release()를 호출 시,<br>
당연히 오브젝트는 풀 안으로 들어가게 된다.</p><p><img alt="UnityEngine.ObjectPool - Pool" src="/assets/images/objectpooling7-25bd7d7fddb3f1c270735a45d79247ea.png"></p><p>그러나 풀에 공간이 없을 경우, Release() 호출 시 해당 오브젝트들은 파괴된다.<br>
위의 그림같은 경우, 오브젝트 B와 C는 풀에 자리가 없으므로 파괴되는 것이다.</p><p>그러면 이제 UnityEngine.Pool을 사용하여 실제로 오브젝트 풀링을 구현한 코드를 보도록 하자.<br>
우선 이재민님의 영상에서 나오는 UnityEngine.Pool을 활용한 예제 코드는 아래와 같다.<br>
영상 2편 설명란에 샘플 프로젝트를 다운받을 수 있는 링크가 올라와 있으니 직접 프로젝트를 열어보는 것도 좋다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.Pool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class HatCreator : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ObjectPool&lt;Hat&gt; _hatPool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Hat hatPrefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _hatPool = new ObjectPool&lt;Hat&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    createFunc: () =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        var createdHat = Instantiate(hatPrefab);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        createdHat.poolToReturn = _hatPool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        return createdHat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    actionOnGet: (hat) =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        hat.gameObject.SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        hat.Reset();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    actionOnRelease: (hat) =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        hat.gameObject.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    actionOnDestroy: (hat) =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Destroy(hat.gameObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    maxSize: 30);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Input.GetMouseButtonDown(0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var count = Random.Range(1, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; count; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                CreateHat();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void CreateHat()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var position = Random.insideUnitSphere + new Vector3(0, 3, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var rotation = Random.rotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var hat = _hatPool.Get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hat.transform.position = position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hat.transform.rotation = rotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>위의 코드는 오브젝트 풀을 구현하는 코드이다.<br>
UnityEngine.Pool에서 제공하는 오브젝트 풀을 생성하기 위해서는 5가지 매개변수를 넘겨줘야 한다.<br>
그것이 바로 위의 Start에서 볼 수 있는 createFunc, actionOnGet, actionOnRelease, actionOnDestroy, maxSize이다.</p><p><strong>createFunc</strong>는 오브젝트 풀에 오브젝트가 없을 시 생성할 오브젝트를 반환하도록 하면 된다.<br>
<strong>actionOnGet</strong>은 풀에서 Get()을 호출 시 동작하며, <strong>actionOnRelease</strong>는 반대로 Release()를 호출 시 동작하는 내용이다.<br>
<strong>actionOnDestroy</strong>는 풀에 자리가 없을 경우의 오브젝트에 대한 처리라고 볼 수 있다.<br>
<strong>maxSize</strong>는 해당 오브젝트 풀의 사이즈를 지정하는 것이다. 위의 예제에서는 30개의 오브젝트를 담도록 만들어졌다.</p><p>CreateHat 메서드는 오브젝트 풀에서 생성되는 hat 오브젝트의 position과 rotation을 지정하고,<br>
오브젝트 풀의 Get()을 통해 오브젝트를 생성하거나, 또는 풀에서 가져오는 동작을 수행한다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine.Pool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Hat : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public IObjectPool&lt;Hat&gt; poolToReturn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool IsTriggered { get; private set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IsTriggered = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnCollisionEnter(Collision other)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (IsTriggered)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (other.collider.CompareTag(&quot;Ground&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            IsTriggered = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            StartCoroutine(DestroyHat);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IEnumerator DestroyHat()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yield return new WaitForSecond(3f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolToReturn.Release(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>위의 Hat 클래스는 오브젝트 풀에서 꺼내지는 오브젝트 hat에 부착된 스크립트의 클래스이다.<br>
단순한 기능을 수행하는데, 여기서 눈여겨봐야 할 점은 IObjectPool형 변수인 poolToReturn이다.<br>
해당 오브젝트는 OnCollisionEnter와 DestroyHat 코루틴에서 볼 수 있듯이,<br>
땅에 닿을 경우, 3초 후에 풀로 돌아가는 동작을 수행하는데, 이를 위해 poolToReturn을 선언하고,<br>
HatCreator에서 오브젝트 풀을 선언할 때 createFunc에서 해당 풀을 지정해주도록 하는 것이다.<br>
이를 통해 hat 오브젝트들은 생성될 시 돌아가야 할 풀을 기억하고 있을 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3-매니저-클래스를-통한-다중-object-pooling-구현">3. 매니저 클래스를 통한 다중 Object Pooling 구현<a aria-hidden="true" class="hash-link" href="#3-매니저-클래스를-통한-다중-object-pooling-구현" title="Direct link to heading">​</a></h3><p><a href="https://www.youtube.com/watch?v=tdSmKaJvCoA" target="_blank" rel="noopener noreferrer">Brackeys - OBJECT POOLING in Unity!</a></p><p>이 내용은 Brackeys라는 유명 유니티 크리에이터 채널에서 배운 내용이다.<br>
Brackeys 채널은 비록 새로운 영상이 올라오지 않은 지는 좀 되었지만, <br>
지금까지도 유용한 유니티 게임 제작의 기초 지식들이 많기 때문에 한번쯤 참고해보면 큰 도움이 된다.</p><p>위의 영상에서는 하나의 Singleton 오브젝트, 즉 매니저급의 클래스를 통해<br>
여러 개의 오브젝트 풀을 생성하고 관리하는 방법에 대해서 설명하고 있다.</p><p>우선 곧바로 예시 코드를 살펴보자.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ObjectPooler : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [System.Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class Pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string tag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public GameObject prefab;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public int size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;Pool&gt; pools;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Dictionary&lt;string, Queue&lt;GameObject&gt;&gt; poolDictionary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GameObject SpawnFromPool(string tag, Vector3 position, Quaternion rotation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!poolDictionary.ContainsKey(tag))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GameObject objectToSpawn = poolDictionary[tag].Dequeue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectToSpawn.SetActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectToSpawn.transform.position = position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        objectToSpawn.transform.rotation = rotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IPooledObject pooledObj = objectToSpawn.GetComponent&lt;IPooledObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (pooledObj != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pooledObj.OnObjectSpawn();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolDictionary[tag].Enqueue(objectToSpawn);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return objectToSpawn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #region Singleton</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ObjectPooler Instance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Awake()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Instance != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Destroy(this;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Instance = this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        poolDictionary = new Dictionary&lt;string, Queue&lt;GameObject&gt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach(Pool pool in pools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Queue&lt;GameObject&gt; objectPool = new Queue&lt;GameObject&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; pool.size; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                GameObject obj = Instantiate(pool.prefab);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                obj.SetActive(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                objectPool.Enqueue(obj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            poolDictionary.Add(pool.tag, objectPool);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>이 클래스는 Dictionary와 List를 통해 여러 개의 오브젝트 풀을 동시에 사용할 수 있도록 해준다.<br>
우선, System.Serializable 속성이 붙은 Pool 클래스가 있다.<br>
이는 유니티 에디터 상에서 Pool 클래스의 public 또는 serialized 속성이 붙은 멤버에 접근할 수 있도록 해준다.<br>
이를 통해 에디터 상에서 Pool형을 담을 수 있는 List인 pools에 오브젝트 풀로 만들 오브젝트들을 설정해주면 된다.<br>
풀에 담을 오브젝트의 프리팹, 그리고 오브젝트를 불러올 때 쓸 태그와 풀의 사이즈를 지정해준다.<br>
태그는 Dictionary로부터 그에 해당하는 오브젝트 풀을 찾아야 하기 때문에 설정하는 것이다.</p><p>이렇게 설정하고 에디터를 플레이모드로 실행하면, poolDictionary가 초기화 된 후,<br>
pools List에 있는 Pool 클래스의 수만큼 Queue가 생성되고, <br>
해당 Queue에 Pool의 size만큼 Pool에 지정해둔 prefab을 담는다.<br>
그리고 poolDictionary로부터 해당 풀을 찾을 수 있도록, Pool 클래스의 tag와 오브젝트 풀을 한 쌍으로 묶어 추가한다.</p><p>SpawnFromPool은 Dictionary로부터 오브젝트 풀을 찾고, 그로부터 오브젝트를 꺼내오는 메서드이다.<br>
우선 매개변수로 문자열, Vector3, Quaternion을 받는다.<br>
문자열을 받는 이유는 태그 이름을 찾아 해당하는 오브젝트 풀을 찾기 위함이다.<br>
Vector3와 Quaternion은 꺼낸 오브젝트의 position과 rotation을 설정하기 위한 매개변수이다.</p><p>이 예제에서 오브젝트 풀에 들어갈 오브젝트들은 모두 IPooledObject 인터페이스를 상속받는다.<br>
IPooledObject는 아래와 같이 OnObjectSpawn() 하나만을 구현하면 되는 단순한 인터페이스이다.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI C#"><pre tabindex="0" class="prism-code language-C# codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public interface IPooledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnObjectSpawn();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Dictionary에서 tag에 해당하는 풀이 있음을 확인하면,<br>
해당 풀에서 오브젝트를 하나 Dequeue로 꺼내온 후 활성화하고, position과 rotation을 지정해준다.<br>
그 다음, 생성된 각 오브젝트에서 따로 수행해야 할 일이 있다면, <br>
이는 IPooledObject를 구현하는 OnObjectSpawn()에서 실행하도록 한다.</p><p>마지막으로, 이 예제에서는 큐에서 꺼낸 오브젝트에서 OnObjectSpawn()을 실행하고 바로 다시 큐에 집어넣도록 하고 있다.<br>
즉, 오브젝트는 작동 중이지만, 그와 동시에 큐로 바로 다시 들어와 있는 상태인 것이다.</p><p>이 예제의 경우, 여러 개의 오브젝트 풀을 한번에 에디터를 통해 설정할 수 있다는 점에서는 매우 편리했지만,<br>
위의 두 예제와는 다르게 오브젝트의 개수가 유동적이지 않았다. 즉, 풀이 지정한 개수 이상으로 생성이 불가능하다.<br>
물론 이 점은 사용하는 사람에 따라서 코드를 약간만 본인의 용도에 맞게 수정하면 쉽게 해결되는 문제이다.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/c">C#</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/unity">Unity</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/docs/tags/object-pooling">Object Pooling</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Despria/Despria.github.io/docs/Programming/Unity/ObjectPooling_1.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Programming/Unity/Unity_Basic_4"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Unity를 위한 기본 문법 4</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Programming/Unity/AssetBundle_1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AssetBundle 빌드하기<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#object-pooling-구현" class="table-of-contents__link toc-highlight">Object Pooling 구현</a><ul><li><a href="#1-delegate를-이용한-object-pooling-구현" class="table-of-contents__link toc-highlight">1. delegate를 이용한 Object Pooling 구현</a></li><li><a href="#2-unityenginepool을-통한-object-pooling-구현" class="table-of-contents__link toc-highlight">2. UnityEngine.Pool을 통한 Object Pooling 구현</a></li><li><a href="#3-매니저-클래스를-통한-다중-object-pooling-구현" class="table-of-contents__link toc-highlight">3. 매니저 클래스를 통한 다중 Object Pooling 구현</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documents</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Despria" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.54a63bd4.js"></script>
<script src="/assets/js/main.e0c2ea69.js"></script>
</body>
</html>